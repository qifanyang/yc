!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ES6Promise=t()}(this,function(){"use strict";function r(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function c(e){return"function"==typeof e}function e(e){D=e}function t(e){J=e}function n(){return function(){return process.nextTick(u)}}function o(){return"undefined"!=typeof L?function(){L(u)}:a()}function i(){var e=0,t=new H(u),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function s(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}function a(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<U;e+=2){var t=K[e],n=K[e+1];t(n),K[e]=void 0,K[e+1]=void 0}U=0}function l(){try{var e=Function("return this")().require("vertx");return L=e.runOnLoop||e.runOnContext,o()}catch(e){return a()}}function f(e,t){var n=this,r=new this.constructor(d);void 0===r[z]&&x(r);var o=n._state;if(o){var i=arguments[o-1];J(function(){return M(o,r,i,n._result)})}else O(n,r,e,t);return r}function p(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(d);return w(n,e),n}function d(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function v(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function g(e,r,o){J(function(t){var n=!1,e=v(o,r,function(e){n||(n=!0,r!==e?w(t,e):j(t,e))},function(e){n||(n=!0,C(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&e&&(n=!0,C(t,e))},e)}function y(t,e){e._state===$?j(t,e._result):e._state===Q?C(t,e._result):O(e,void 0,function(e){return w(t,e)},function(e){return C(t,e)})}function b(e,t,n){t.constructor===e.constructor&&n===f&&t.constructor.resolve===p?y(e,t):void 0===n?j(e,t):c(n)?g(e,t,n):j(e,t)}function w(t,e){if(t===e)C(t,h());else if(r(e)){var n=void 0;try{n=e.then}catch(e){return void C(t,e)}b(t,e,n)}else j(t,e)}function _(e){e._onerror&&e._onerror(e._result),T(e)}function j(e,t){e._state===Z&&(e._result=t,e._state=$,0!==e._subscribers.length&&J(T,e))}function C(e,t){e._state===Z&&(e._state=Q,e._result=t,J(_,e))}function O(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+$]=n,o[i+Q]=r,0===i&&e._state&&J(T,e)}function T(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?M(n,r,o,i):o(i);e._subscribers.length=0}}function M(e,t,n,r){var o=c(n),i=void 0,s=void 0,a=!0;if(o){try{i=n(r)}catch(e){a=!1,s=e}if(t===i)return void C(t,m())}else i=r;t._state!==Z||(o&&a?w(t,i):a===!1?C(t,s):e===$?j(t,i):e===Q&&C(t,i))}function k(t,e){try{e(function(e){w(t,e)},function(e){C(t,e)})}catch(e){C(t,e)}}function S(){return ee++}function x(e){e[z]=ee++,e._state=void 0,e._result=void 0,e._subscribers=[]}function A(){return new Error("Array Methods must be provided an Array")}function I(e){return new te(this,e).promise}function P(o){var i=this;return new i(R(o)?function(e,t){for(var n=o.length,r=0;r<n;r++)i.resolve(o[r]).then(e,t)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function W(e){var t=this,n=new t(d);return C(n,e),n}function q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function G(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=ne}var E=void 0;E=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var R=E,U=0,L=void 0,D=void 0,J=function(e,t){K[U]=e,K[U+1]=t,U+=2,2===U&&(D?D(u):Y())},V="undefined"!=typeof window?window:void 0,F=V||{},H=F.MutationObserver||F.WebKitMutationObserver,B="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),X="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,K=new Array(1e3),Y=void 0;Y=B?n():H?i():X?s():void 0===V&&"function"==typeof require?l():a();var z=Math.random().toString(36).substring(2),Z=void 0,$=1,Q=2,ee=0,te=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(d),this.promise[z]||x(this.promise),R(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?j(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&j(this.promise,this._result))):C(this.promise,A())}return e.prototype._enumerate=function(e){for(var t=0;this._state===Z&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===p){var o=void 0,i=void 0,s=!1;try{o=t.then}catch(e){s=!0,i=e}if(o===f&&t._state!==Z)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===ne){var a=new n(d);s?C(a,i):b(a,t,o),this._willSettleAt(a,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===Z&&(this._remaining--,e===Q?C(r,n):this._result[t]=n),0===this._remaining&&j(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;O(e,void 0,function(e){return n._settledAt($,t,e)},function(e){return n._settledAt(Q,t,e)})},e}(),ne=function(){function t(e){this[z]=S(),this._result=this._state=void 0,this._subscribers=[],d!==e&&("function"!=typeof e&&q(),this instanceof t?k(this,e):G())}return t.prototype["catch"]=function(e){return this.then(null,e)},t.prototype["finally"]=function(t){var e=this,n=e.constructor;return c(t)?e.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):e.then(t,t)},t}();return ne.prototype.then=f,ne.all=I,ne.race=P,ne.resolve=p,ne.reject=W,ne._setScheduler=e,ne._setAsap=t,ne._asap=J,ne.polyfill=N,ne.Promise=ne,ne.polyfill(),ne});(function(w,_){function e(e){function t(){function c(e,t){function n(e,t,n){var r=[];e=n===_?e:n+"["+e+"]";if(typeof t==="object"&&t!==null){r=r.concat(c(t,e))}else{e=encodeURIComponent(e);t=encodeURIComponent(t);r.push(e+"="+t)}return r}var r=[],o;if(Object.prototype.toString.call(e)=="[object Array]"){for(var i=0,s=e.length;i<s;i++){o=e[i];r=r.concat(n(typeof o=="object"?i:"",o,t))}}else if(Object.prototype.toString.call(e)=="[object Object]"){for(var a in e){o=e[a];r=r.concat(n(a,o,t))}}return r}function e(e){var t=e.split("&");for(var n=0,r=t.length;n<r;n++){key=encodeURIComponent(t[n].split("=")[0]);value=encodeURIComponent(t[n].split("=")[1]);t[n]=key+"="+value}return t}if(l){var t=c(l);t=t.join("&").replace("/%20/g","+");i+=i.indexOf("?")>-1?i.indexOf("=")>-1?"&"+t:t:"?"+t}if(a){if(s==="post"&&u&&u.indexOf("json")>-1){return a}else{if(typeof a==="string"){a=e(a)}else if(typeof a==="object"){a=c(a)}a=a.join("&").replace("/%20/g","+");if(s==="get"||f==="jsonp"){i+=i.indexOf("?")>-1?i.indexOf("=")>-1?"&"+a:a:"?"+a}}}}function n(){var t=document.createElement("script"),e=(new Date).getTime()+Math.round(Math.random()*1e3),n=c||"JSONP_"+e;w[n]=function(e){clearTimeout(y);document.body.removeChild(t);v(e)};t.src=i;t.type="text/javascript";document.body.appendChild(t);r(n,t)}function r(e,t){if(d!==_){y=setTimeout(function(){if(f==="jsonp"){w[e]=function(){clearTimeout(y);document.body.removeChild(t);delete w[e]}}else{g=true;b&&b.abort()}m&&m("timeout")},d)}}function o(){function e(){if(w.XMLHttpRequest){return new XMLHttpRequest}else{var e=["Microsoft","msxm3","msxml2","msxml1"];for(var t=0;t<e.length;t++){try{var n=e[t]+".XMLHTTP";return new ActiveXObject(n)}catch(e){}}}}b=e();b.open(s,i,p);if(s==="post"&&!u){b.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")}else if(u){b.setRequestHeader("Content-Type",u)}b.onreadystatechange=function(){if(b.readyState===4){if(d!==_){if(g){return}clearTimeout(y)}if(b.status>=200&&b.status<300||b.status==304){v(b.responseText)}else{m(b.status,b.statusText)}}};b.send(s==="get"?null:a);r()}var i=e.url||"",s=(e.type||"get").toLowerCase(),a=e.data||null,u=e.contentType||"",l=e.queryString||null,f=e.dataType||"",c=e.jsonpCallback||"",p=e.async===_?true:e.async,d=e.timeOut,h=e.before||function(){},m=e.error||function(){},v=e.success||function(){};var g=false,y=null,b=null;t();h();if(f==="jsonp"){n()}else{o()}}w.ajax=e})(window);!function(e){"use strict";if("object"==typeof exports&&null!=exports&&"number"!=typeof exports.nodeType)module.exports=e();else if("function"==typeof define&&null!=define.amd)define([],e);else{var t=e(),n="undefined"!=typeof self?self:$.global;"function"!=typeof n.btoa&&(n.btoa=t.btoa),"function"!=typeof n.atob&&(n.atob=t.atob)}}(function(){"use strict";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function c(e){this.message=e}return(c.prototype=new Error).name="InvalidCharacterError",{btoa:function(e){for(var t,n,r=String(e),o=0,i=a,s="";r.charAt(0|o)||(i="=",o%1);s+=i.charAt(63&t>>8-o%1*8)){if(255<(n=r.charCodeAt(o+=.75)))throw new c("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return s},atob:function(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new c("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,o=0,i=0,s="";r=t.charAt(i++);~r&&(n=o%4?64*n+r:r,o++%4)&&(s+=String.fromCharCode(255&n>>(-2*o&6))))r=a.indexOf(r);return s}}});(function(e,i){var o="propertyIsEnumerable,isPrototypeOf,hasOwnProperty,toLocaleString,toString,valueOf,constructor".split(","),s={}.hasOwnProperty;for(var t in{toString:1}){o=false}Object.keys=Object.keys||function(e){var t=[];for(var n in e)if(s.call(e,n)){t.push(n)}if(o&&e){for(var r=0;n=o[r++];){if(s.call(e,n)){t.push(n)}}}return t};if(!Array.prototype.forEach){Array.prototype.forEach=function(e){var t,n;if(this==null){throw new TypeError("this is null or not defined")}var r=Object(this);var o=r.length>>>0;if(typeof e!=="function"){throw new TypeError(e+" is not a function")}if(arguments.length>1){t=arguments[1]}n=0;while(n<o){var i;if(n in r){i=r[n];e.call(t,i,n,r)}n++}}}if(typeof Array.prototype.map!="function"){Array.prototype.map=function(e,t){var n=[];if(typeof e==="function"){for(var r=0,o=this.length;r<o;r++){n.push(e.call(t,this[r],r,this))}}return n}}Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n){if(Object.prototype.hasOwnProperty.call(n,r)){e[r]=n[r]}}}return e};var n="https://flow.qq.com/api/common";var a;var c={channelid:"",deviceidtype:0,useridtype:0,userid:""};var u={};var l=0;var f=false;var p=1,d=[];var h;var m=null;a={queryGWInfo:n+"/queryGWInfo",getMaskMobileV3:n+"/getMaskMobileV3",getMaskMobileV4:n+"/getMaskMobileV4"};function r(e,t,n){if(typeof t=="string"){n=t;t=function(){}}var r=i.createElement("script"),o=i.getElementsByTagName("head")[0];r.setAttribute("charset",n||"utf-8");r.src=e;r.onload=function(){console.log(e);t&&t()};o.appendChild(r)}(function e(){if(navigator.userAgent.indexOf("GDTTangramMobSDK")>-1&&navigator.userAgent.indexOf("GDTMobSDK")>-1){h=25;r("https://obd.gtimg.com/gateway_mobile/unV3.js")}else if(navigator.userAgent.indexOf("GDTMobSDK")>-1){h=15;r("https://obd.gtimg.com/gateway_mobile/unV3.js")}else if(navigator.userAgent.indexOf("WEISHI")>-1){h=1;r("https://qzonestyle.gtimg.cn/qzone/hybrid/app/weishi/lib/wsapi.js")}else if(navigator.userAgent.indexOf("qqnews")>-1){h=2;r("https://mat1.gtimg.com/www/js/newsapp/jsapi/news.js?_tsid=1")}})();function v(e){return new Promise(function(r,t){try{if(h===15||h===25){window.unjs.network.requestByCellularNetwork({url:e,site:h},function(e){console.log("requestByCellularNetwork",e);if(typeof e=="string"){var t=JSON.parse(e);var n;if(+t.code===0){n=t.data}else if(t&&t.response){n=JSON.parse(t.response)}else{r(t)}r(n)}else{r(e)}})}else if(h===1){window.mqq.invoke("weishi","getPhoneNumberFromNetwork",{url:e},function(e){console.log("getPhoneNumberFromNetwork",e);if(e&&e.data.code==0){var t=JSON.parse(e.data.data);r(t)}else{r(e)}})}else if(h===2){window.TencentNews.invoke("requestWithMobile",{url:e,onCallback:function(e){console.log("requestWithMobile-onCallback",e);if(e&&e.code==0){var t=e.response.nameValuePairs||e.response;r(t)}else{r(e)}}})}else{t("无sdk桥接能力")}}catch(e){t(e)}})}e.TXYZ={setConfigProcess:function(){n="https://h5gatewaymobile.sparta.html5.qq.com/api/common";a={queryGWInfo:n+"/queryGWInfo",getMaskMobileV3:n+"/getMaskMobileV3",getMaskMobileV4:n+"/getMaskMobileV4"}},getMaskMobile:function(e){var t=e&&e.params;if(!t||!t.channelid||!t.userid){e.error&&e.error({message:"missing channelid or userid"});return}f=false;p=1;d=[];m=null;u=e||{};c["channelid"]=t.channelid;c["userid"]=t.userid;c["deviceidtype"]=t.deviceidtype||0;c["useridtype"]=t.useridtype||0;var n=h?"v4":t.source||"mix";function r(e){Promise.race(e).then(function(e){f=true;m=e;u.success&&u.success(e)})}if(n==="v3"){g({version:"v3"}).then(function(e){r([_(e.urlInfo[0],e.urlFlagId)])})}else if(n==="v4"){r([y()])}else if(n==="mix"){g({version:"v3"}).then(function(e){var t=[y()];if(e.urlInfo[0].channelCarrierType!=2){p=2;t.push(_(e.urlInfo[0],e.urlFlagId))}r(t)})}}};function g(r){var e={vType:0,clientType:20010,format:h>0?"json":"jsonp",version:r.version};if(!h){e.callback="operatorCallback"}if(r.version==="v3"){e.httpsPage=h>0?0:1}return new Promise(function(n){ajax({type:"POST",url:a.queryGWInfo,data:JSON.stringify(e),contentType:"application/json",queryString:c,success:function(e){e=JSON.parse(e);if(e.retCode===0){var t=e.data;if(t.urlInfo&&t.urlInfo.length!=0){n(t)}else{O({message:r.version+" urls list none"})}}else{O({code:e.retCode,message:e.retMsg})}},error:function(){O({message:r.version+" getgwurls api fail"})}})})}function y(){return new Promise(function(n){g({version:"v4"}).then(function(t){b(t.urlInfo).then(function(e){w(t.urlInfo[0].mobileGWMsgId,t.urlFlagId,e).then(function(e){n(e)})})})})}function b(e){function n(r){return new Promise(function(t,n){v(r.mobileGWURL).then(function(e){t({mobileGWChannel:r.mobileGWChannel,callbackData:window.btoa(unescape(encodeURIComponent(JSON.stringify(e))))})}).catch(function(e){ajax({url:r.mobileGWURL,dataType:"jsonp",jsonpCallback:r.callBackName,timeOut:5e3,success:function(e){t({mobileGWChannel:r.mobileGWChannel,callbackData:window.btoa(unescape(encodeURIComponent(JSON.stringify(e))))})},error:function(e){n(e)}})})}).catch(function(e){console.log("getTokenError：","channel",r.mobileGWChannel,e)})}return new Promise(function(t){Promise.all(e.map(n)).then(function(e){e=e.filter(function(e){return e!=undefined});t(e)})})}function w(e,t,n){var r={format:h>0?"json":"jsonp",mobileGWMsgId:e,urlFlagId:t,gwTokenDataList:n};return new Promise(function(t){ajax({type:"POST",url:a.getMaskMobileV4,data:JSON.stringify(r),contentType:"application/json",queryString:c,success:function(e){e=JSON.parse(e);if(e.retCode===0){t(e.data)}else{O({code:e.retCode,message:e.retMsg})}},error:function(){O({message:"v4 getmoskmobile api fail"})}})})}function _(n,r){console.log("");return new Promise(function(t){v(n.mobileGWURL).then(function(e){e=window.btoa(unescape(encodeURIComponent(JSON.stringify(e))));j(n,r,e).then(function(e){t(e)})}).catch(function(e){if(/^https/.test(n.mobileGWURL)){ajax({url:n.mobileGWURL,dataType:"jsonp",jsonpCallback:n.callBackName,success:function(e){e=window.btoa(unescape(encodeURIComponent(JSON.stringify(e))));j(n,r,e).then(function(e){t(e)})},error:function(){O({message:"v3 urls api fail"})}})}else{C(n,r).then(function(e){t(e)})}})})}function j(n,r,e){var o={mobileGWMsgId:n.mobileGWMsgId,mobileGWChannel:n.mobileGWChannel,channelCarrierType:n.channelCarrierType,upLinkUrl:n.mobileGWURL,format:h>0?"json":"jsonp",redirectFormat:h>0?"json":"jsonp",redirectCallback:"redirectCallback",httpsPage:h>0?0:1,urlFlagId:r};if(e){o.callbackData=e}return new Promise(function(t){ajax({type:"POST",url:a.getMaskMobileV3,data:JSON.stringify(o),contentType:"application/json",queryString:c,success:function(e){e=JSON.parse(e);if(e.retCode===0){e=e.data;if(e.dataType==1){l=0;m=e.mobileData;t(e.mobileData)}else if(e.dataType==3){if(n.mobileGWChannel!==e.redirectData.mobileGWChannel){l=0;O({message:"v3 redirect channel different"});return}if(l<5){l++;_(e.redirectData,r).then(function(e){t(e)})}else{l=0;O({message:"v3 redirect more than 5 times"})}}}else{O({code:e.retCode,message:e.retMsg})}},error:function(){O({message:"v3 getmoskmobile api fail"})}})})}function C(n,r){console.log("upLinkRes",n,r);return new Promise(function(t){var e=new Image;e.src=n.mobileGWURL;e.onload=function(e){j(n,r).then(function(e){console.log("mobileRes",e);t(e)})};e.onerror=function(e){O({msgId:n.mobileGWMsgId,message:"v3 image load fail"})}})}function O(e){if(!f){d.push(e);if(d.length==p){u.error&&u.error(d)}}}})(window,document);